<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MASTER HUB DASHBOARD (V19.0)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>body { font-family: 'Kanit', sans-serif; }</style>
</head>
<body class="bg-slate-50 min-h-screen p-4 md:p-10 font-['Kanit'] italic">
    <div class="max-w-6xl mx-auto">
        <div class="flex flex-col md:flex-row justify-between items-center mb-10 gap-6">
            <div>
                <h1 class="text-3xl font-bold text-slate-800 uppercase tracking-tighter">Master Hub <span class="text-blue-600">Dashboard</span></h1>
                <p class="text-[10px] font-bold text-slate-400 uppercase tracking-[0.4em] mt-2">Full Control & System Management</p>
            </div>
            <select id="projectSelect" onchange="init()" class="p-4 bg-white rounded-2xl shadow-sm border-none font-bold text-xs uppercase cursor-pointer ring-1 ring-slate-100 outline-none">
                <option value="Project_Master">⭐ Project Master (HP-Z)</option>
                <option value="Project_A">Project A (HP-A)</option>
                <option value="Project_B">Project B (HP-B)</option>
                <option value="Project_C">Project C (HP-C)</option>
                <option value="Project_D">Project D (HP-D)</option>
            </select>
        </div>

        <div class="relative mb-8 group">
            <i class="fa-solid fa-magnifying-glass absolute left-6 top-5 text-slate-300 group-focus-within:text-blue-600 transition-colors"></i>
            <input type="text" id="searchInput" onkeyup="searchTable()" placeholder="พิมพ์รหัสบ้าน (เช่น a013) หรือชื่อบ้านเพื่อค้นหา..." class="w-full pl-14 pr-6 py-4 bg-white rounded-2xl shadow-sm outline-none border border-slate-100 focus:ring-4 ring-blue-50 transition-all font-bold text-sm italic">
        </div>

        <div class="bg-white rounded-[2.5rem] shadow-xl overflow-hidden border border-slate-100">
            <div class="overflow-x-auto">
                <table class="w-full text-left border-collapse" id="masterDashboardTable">
                    <thead class="bg-slate-900 text-white text-[10px] uppercase tracking-widest font-bold italic">
                        <tr>
                            <th class="p-8">Unit ID</th>
                            <th class="p-8">Name</th>
                            <th class="p-8">Type/Plot</th>
                            <th class="p-8 text-center">Status</th>
                            <th class="p-8 text-center">Action</th>
                        </tr>
                    </thead>
                    <tbody id="unitTableBody" class="text-slate-600 text-sm font-medium italic">
                        </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycbxO40_bOBK66N22L6AWzBWaagzNkxSXs4KuvY5hRZ3vE4miazrpn7iNttlgmtGERmXV/exec"; //

        // 1. ฟังก์ชันดึงข้อมูล
        async function init() {
            const proj = document.getElementById('projectSelect').value;
            const tbody = document.getElementById('unitTableBody');
            tbody.innerHTML = '<tr><td colspan="5" class="p-10 text-center animate-pulse text-slate-400">⏳ กำลังเชื่อมต่อข้อมูล MASTER...</td></tr>';
            
            try {
                const res = await fetch(`${API_URL}?mode=getUnitList&project=${proj}`);
                const units = await res.json();
                
                tbody.innerHTML = units.map(u => `
                    <tr class="border-b border-slate-50 hover:bg-slate-50/50 transition-colors">
                        <td class="p-8 font-bold text-slate-900">${u.id}</td>
                        <td class="p-8 italic font-bold text-slate-500">${u.name || '-'}</td>
                        <td class="p-8 text-[10px] font-bold uppercase text-slate-400">${u.id.split('-')[1] || u.id}</td>
                        <td class="p-8 text-center">
                            <span class="px-4 py-1.5 rounded-full text-[9px] font-bold uppercase italic ${getStatusClass(u.status)}">
                                ${u.status || 'Pending'}
                            </span>
                        </td>
                        <td class="p-8 text-center">
                            <button class="bg-blue-600 text-white px-5 py-2 rounded-xl text-[10px] font-bold shadow-sm hover:bg-slate-900 transition-all uppercase">
                                Manage
                            </button>
                        </td>
                    </tr>`).join('');
            } catch (e) { 
                tbody.innerHTML = "<tr><td colspan='5' class='p-10 text-center text-red-500 font-bold'>❌ ไม่สามารถซิงค์ข้อมูลได้</td></tr>"; 
            }
        }

        // 2. ฟังก์ชัน Search ที่แก้ไขแล้ว (สำคัญ!)
        function searchTable() {
            const input = document.getElementById("searchInput");
            const filter = input.value.toUpperCase();
            const table = document.getElementById("masterDashboardTable");
            const tr = table.getElementsByTagName("tr");

            for (let i = 1; i < tr.length; i++) {
                let showRow = false;
                const tdId = tr[i].getElementsByTagName("td")[0]; // คอลัมน์ Unit ID
                const tdName = tr[i].getElementsByTagName("td")[1]; // คอลัมน์ Name
                
                if (tdId || tdName) {
                    const textId = tdId.textContent || tdId.innerText;
                    const textName = tdName.textContent || tdName.innerText;
                    
                    // ค้นหาทั้งรหัสบ้านและชื่อบ้าน
                    if (textId.toUpperCase().indexOf(filter) > -1 || textName.toUpperCase().indexOf(filter) > -1) {
                        showRow = true;
                    }
                }
                tr[i].style.display = showRow ? "" : "none";
            }
        }

        function getStatusClass(s) {
            if (s === 'Live' || s === 'Online') return 'bg-green-50 text-green-600';
            if (s === 'Sold') return 'bg-red-50 text-red-600';
            return 'bg-yellow-50 text-yellow-600';
        }

        window.onload = init;
    </script>
</body>
</html>
