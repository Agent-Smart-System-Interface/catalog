<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>Master Full Control Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;600&display=swap" rel="stylesheet">
    <style>body { font-family: 'Kanit', sans-serif; }</style>
</head>
<body class="bg-slate-50 min-h-screen p-6">
    <div class="max-w-xl mx-auto bg-white rounded-[2rem] shadow-xl p-10">
        <h1 class="text-2xl font-bold text-center mb-8 uppercase text-slate-800">Master Full Control</h1>
        
        <div class="flex bg-slate-100 p-1 rounded-xl mb-6">
            <button id="addBtn" onclick="switchMode('add')" class="flex-1 py-2 rounded-lg font-bold bg-white shadow-sm text-blue-600 transition-all">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
            <button id="editBtn" onclick="switchMode('edit')" class="flex-1 py-2 rounded-lg font-bold text-slate-400 transition-all">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏°</button>
        </div>

        <div class="space-y-4">
            <select id="projectSelect" onchange="handleProjectChange()" class="w-full p-4 bg-gray-50 rounded-2xl border-none outline-none focus:ring-2 ring-blue-500 font-bold">
                <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ --</option>
                <option value="Project_Master">‚≠ê Agent Master Hub (HP-Z)</option>
                <option value="Project_A">Project A (HP-A)</option>
                <option value="Project_B">Project B (HP-B)</option>
            </select>

            <div id="editSection" class="hidden">
                <label class="text-[10px] font-bold text-slate-400 uppercase ml-1">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</label>
                <select id="unitSelect" onchange="fetchDetail()" class="w-full p-4 bg-blue-50 text-blue-700 font-bold rounded-2xl border-none ring-1 ring-blue-100 outline-none"></select>
            </div>

            <div id="addSection">
                <label class="text-[10px] font-bold text-slate-400 uppercase ml-1">‡∏£‡∏´‡∏±‡∏™ ID ‡∏ß‡πà‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡πÉ‡∏´‡πâ</label>
                <input type="text" id="hpIdDisplay" readonly class="w-full p-4 bg-green-50 text-green-600 font-bold text-center rounded-2xl border-none outline-none">
            </div>

            <div id="formFields" class="hidden space-y-4 border-t pt-6">
                <input type="text" id="idName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡πâ‡∏≤‡∏ô / ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®" class="w-full p-4 bg-gray-50 rounded-2xl outline-none border-none">
                <select id="sysStatus" class="w-full p-4 bg-gray-50 rounded-2xl outline-none font-bold border-none">
                    <option value="Online">üü¢ Online (‡πÇ‡∏ä‡∏ß‡πå‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö)</option>
                    <option value="Inactive">üî¥ Inactive (‡∏ã‡πà‡∏≠‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)</option>
                    <option value="Open for Edit">üü° Open for Edit (‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡πâ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç)</option>
                </select>
                <input type="number" id="price" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤" class="w-full p-4 bg-gray-50 rounded-2xl outline-none border-none">
                <textarea id="desc" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î..." class="w-full p-4 bg-gray-50 rounded-2xl h-24 outline-none border-none"></textarea>
                <button onclick="submit()" id="saveBtn" class="w-full bg-blue-600 text-white py-5 rounded-2xl font-bold active:scale-95 transition-all uppercase">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</button>
            </div>
        </div>
    </div>

    <script>
        const API = "https://script.google.com/macros/s/AKfycbx0oMpbOThy-0tLUk-MpS6RrbhrbxUozfNUr92Y3wVGhufN51WspGUyuTWnHJ0t0kOE/exec";
        let currentMode = 'add';

        function switchMode(m) {
            currentMode = m;
            document.getElementById('addBtn').className = m === 'add' ? "flex-1 py-2 rounded-lg font-bold bg-white shadow-sm text-blue-600" : "flex-1 py-2 rounded-lg font-bold text-slate-400";
            document.getElementById('editBtn').className = m === 'edit' ? "flex-1 py-2 rounded-lg font-bold bg-white shadow-sm text-blue-600" : "flex-1 py-2 rounded-lg font-bold text-slate-400";
            handleProjectChange();
        }

        async function handleProjectChange() {
            const p = document.getElementById('projectSelect').value;
            if (!p) return;
            document.getElementById('formFields').classList.add('hidden');

            if (currentMode === 'edit') {
                document.getElementById('addSection').classList.add('hidden');
                document.getElementById('editSection').classList.remove('hidden');
                const res = await fetch(`${API}?mode=getUnitList&project=${p}`);
                const units = await res.json();
                document.getElementById('unitSelect').innerHTML = '<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏•‡∏±‡∏á‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç --</option>' + units.map(u => `<option value="${u.id}">${u.id} | ${u.name}</option>`).join('');
            } else {
                document.getElementById('editSection').classList.add('hidden');
                document.getElementById('addSection').classList.remove('hidden');
                const res = await fetch(`${API}?mode=getEditSlot&project=${p}`);
                const id = await res.text();
                document.getElementById('hpIdDisplay').value = id;
                if (id !== "Locked") document.getElementById('formFields').classList.remove('hidden');
            }
        }
        
        async function fetchDetail() {
            // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ñ‡∏ß‡∏ô‡∏±‡πâ‡∏ô‡∏°‡∏≤‡∏•‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏° ‡πÅ‡∏•‡∏∞‡∏™‡∏±‡πà‡∏á‡πÇ‡∏ä‡∏ß‡πå formFields
            document.getElementById('formFields').classList.remove('hidden');
        }

        async function submit() {
            // Logic ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Post ‡πÑ‡∏õ‡∏ó‡∏µ‡πà Apps Script
            alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!"); location.reload();
        }
    </script>
</body>
</html>
